function playNote(n,t,i){return n||(n=1e3),t||(t=1),i||(i="square"),new Promise(r=>{let u=audioCtx.createOscillator();u.type=i;u.frequency.setValueAtTime(n,audioCtx.currentTime);u.connect(masterVolume);u.start();u.stop(audioCtx.currentTime+t);u.onended=r})}let reelContents=["😂","😍","😅","🤔","😜","🤐","😱","😵"],reelLength=3,reelContainers=document.querySelectorAll(".reel-container"),spinningReels=[],spinning=!1,reelDelay=100,money=100,moneyToAdd=0,audioCtx=new(window.AudioContext||window.webkitAudioContext),masterVolume=audioCtx.createGain();masterVolume.gain.setValueAtTime(.05,audioCtx.currentTime);masterVolume.connect(audioCtx.destination);let getReelItem=()=>{let n=document.createElement("div");return n.innerHTML=reelContents[Math.floor(Math.random()*reelContents.length)],n.classList.add("reel-item"),setTimeout(()=>{n.classList.add("active")},0),n},startSpin=()=>{!spinning&&money>0&&(document.querySelectorAll(".prize-item.active").forEach(n=>{n.classList.remove("active")}),updateMoney(-1),setChange(-1),spinningReels.push(0),setTimeout(()=>{spinningReels.push(1)},reelDelay),setTimeout(()=>{spinningReels.push(2)},reelDelay*2),spinning=!0,spinUpdate(7))},spinUpdate=n=>{spinningReels.forEach(n=>{moveReel(n)}),n>0?setTimeout(()=>{spinUpdate(n-1)},reelDelay):spinningReels.length>0?(spinningReels.shift(),setTimeout(()=>{spinUpdate(0)},reelDelay),playNote(spinningReels.length*10- -130,.1)):(spinning=!1,findWins())},moveReel=n=>{let t=reelContainers[n];t.prepend(getReelItem());t.children.length>reelLength&&(t.lastElementChild.classList.add("deactivate"),setTimeout(()=>{t.removeChild(t.lastElementChild)},reelDelay))},updateMoney=n=>{money+=n,document.querySelector("#money").innerText=money},setChange=n=>{let t=document.querySelector(".changes"),i=document.createElement("div");i.innerHTML=n>0?`+${n}`:n;i.classList.add("change");n<0&&i.classList.add("negative");t.prepend(i);t.children.length>6&&t.removeChild(t.lastElementChild)},playWinChime=n=>{let t=n>20?20:n;playNote(400+100*(20-t),.05,"sine");--n>0&&setTimeout(()=>{playWinChime(n)},70)},findWins=()=>{let n=[],t={};if(reelContainers.forEach(i=>{let r=i.children[1].innerText;n.push(r);t[r]?t[r]++:t[r]=1}),n.filter(t=>t===n[0]).length===3)win(3,n[0]),document.querySelector(".triples").children[reelContents.indexOf(n[0])].classList.add("active");else for(s in t)t[s]==2&&(win(2,s),document.querySelector(".doubles").children[reelContents.indexOf(s)].classList.add("active"))},win=(n,t)=>{reelContainers.forEach(n=>{n.children[1].innerText===t&&n.children[1].classList.add("win")});let i=1+reelContents.indexOf(t);playWinChime(i);n==3&&(i*=100);setChange(i);addToMoney(i)},addToMoney=(n,t)=>{let i=Math.ceil(n/2);updateMoney(i);let r=n-i;t||(t=101);t-=5;t<10&&(t=10);r&&setTimeout(()=>{addToMoney(r)},t)};reelContainers.forEach((n,t)=>{for(let n=0;n<reelLength;n++)moveReel(t)});let addToPrizeTable=(n,t,i)=>{let u=document.querySelector(`.prize-table .${i}`),r=document.createElement("div");r.innerHTML=`${n}: ${t}`;r.classList.add("prize-item");r.setAttribute("win-attr",n.replace(/[-❔]/g,""));u.append(r)};reelContents.forEach((n,t)=>{addToPrizeTable(`${n}-${n}-❔`,t+1,"doubles")});reelContents.forEach((n,t)=>{addToPrizeTable(`${n}-${n}-${n}`,(t+1)*100,"triples")});