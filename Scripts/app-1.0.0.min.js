function AddDangerBorder(n){let t=$(this).data("target");if(t===undefined||!(t.indexOf(sessionStorage.Page)<0)){let i=n.val().trim();n.val(i);IsNull(i)===!0?(n.parent().find(".selectize-input").addClass("border-danger"),n.addClass("border-danger"),n.attr("placeholder","請輸入這個欄位")):(n.parent().find(".selectize-input").removeClass("border-danger"),n.removeClass("border-danger"),n.attr("placeholder",""))}}function AjaxErrorHandler(n,t){Loading(!1);switch(n){case 0:$("#form-disconnected-main").text("您目前未連上網路僅提供離線資料，");$("#form-disconnected-msg").text("請檢查行動網路/WiFi是否正常連接。");$("#form-app").show();$("#form-signin").hide();$("#form-disconnected").show();break;case 401:$("#form-app").hide();$("#form-signin").show();return;default:alert(n+"系統發生錯誤："+t)}}function DetectOnLine(){navigator.onLine===!1?AjaxErrorHandler(0,null,null):$("#form-disconnected").hide();setTimeout(DetectOnLine,5e3)}function Init(){"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker-1.0.0.min.js").then(function(n){registration=n;InitNoticeUI()});window.addEventListener("beforeinstallprompt",n=>{n.preventDefault(),installPromptEvent=n,$("#btn-addHome").toggleClass("invisible")});sessionStorage.Page===undefined&&(sessionStorage.Page=MENU1);DetectOnLine();SwitchPage()}function InitNoticeUI(){registration!==null&&"PushManager"in window&&registration.pushManager.getSubscription().then(function(n){isSubscribed=!(n===null);SubscribeNotice()})}function IsNull(n){return n===null||typeof n=="undefined"||n===""||n==="null"}function Loading(n){switch(n){case!0:$(".loader").fadeIn(300);break;default:$(".loader").fadeOut(300)}}function RefreshApp(){caches.keys().then(function(n){$.map(n,function(){caches.delete(name)})});registration.update();location.reload()}function SwitchPage(){let n=$(".js-pageName");$(".js-menu-item").removeClass("active");$(".js-container-content").removeClass("active");switch(sessionStorage.Page){case MENU1:n.text("首頁");break;case MENU2:n.text("PWA 介紹");break;case MENU3:n.text("Slot 遊戲");break;case MENU4:n.text("Wheel 遊戲");break;case MENU5:n.text("Poker 遊戲")}$('.js-menu-item[data-target="'+sessionStorage.Page+'"]').addClass("active");$('.js-container-content[data-trigger="'+sessionStorage.Page+'"]').addClass("active");$(".js-side-nav").removeClass("visible")}function SetUserData(){$("#txt-userName").val(sessionStorage.UserName);$(".js-userName").text(sessionStorage.UserName);IsNull(sessionStorage.UserImage)===!1&&$("#img-userImage").attr("src","data:image/jpeg;base64,"+sessionStorage.UserImage)}function SubscribeNotice(){registration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:UrlB64ToUint8Array(applicationServerPublicKey)}).then(function(){isSubscribed=!0;UpdateSubscribe()}).catch(function(){UpdateSubscribe()})}function UpdateSubscribe(){isSubscribed?$("#btn-openNotice").addClass("invisible"):$("#btn-openNotice").removeClass("invisible")}function UrlB64ToUint8Array(n){const u="=".repeat((4-n.length%4)%4),f=(n+u).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(f),r=new Uint8Array(i.length);for(var t=0;t<i.length;++t)r[t]=i.charCodeAt(t);return r}function ValidateField(n){var t=!0;return $(n+":not(div)").each(function(){let n=$(this).data("target");n!==undefined&&n.indexOf(sessionStorage.Page)<0||(IsNull($(this).val().trim())===!0&&(t=!1),AddDangerBorder($(this)))}),t}const MENU1="Welcome",MENU2="Intro",MENU3="Slot",MENU4="Wheel",MENU5="Poker";let registration=null,isSubscribed=null,dataReaded=!1,installPromptEvent;Date.prototype.addDays=function(n){let t=new Date(this.valueOf());return t.setDate(t.getDate()+n),t};Date.prototype.getWeekOfDay=function(){let t=new Date(this.getFullYear(),this.getMonth(),this.getDate()),n=new Date(this.getFullYear(),0,1);return Math.floor(1+((t-n)/864e5+n.getDay())/7)};Date.prototype.toDateString=function(){let n=this.getDate(),t=this.getMonth()+1,i=(n<10?"0":"")+n,r=(t<10?"0":"")+t;return this.getFullYear()+"-"+r+"-"+i};Init();$("#btn-addHome").click(function(){$("#btn-addHome").toggleClass("invisible");installPromptEvent.prompt();installPromptEvent.userChoice.then(n=>{n.outcome==="accepted"?console.log("User accepted the A2HS prompt"):console.log("User dismissed the A2HS prompt"),installPromptEvent=null})});$("#btn-refresh").click(function(){RefreshApp()});$("#btn-openNotice").click(function(){InitNoticeUI()});$("#dtp-startDate").change(function(){ChangeWeeklyDateInput()});$(".js-edit-required").change(function(){AddDangerBorder($(this))});$(".js-validate").change(function(){Validate($(this),$(this).data("role"))});$(".js-validate").keyup(function(){Validate($(this),$(this).data("role"))});$(".js-validate").bind("paste",function(n){var t=n.originalEvent.clipboardData.getData("Text");$(this).val(t);Validate($(this),$(this).data("role"));event.preventDefault()});$(".js-enter-trigger").keypress(function(n){if(n.which===13){let n=$(this).data("target");$("#"+n).focus();$("#"+n).click()}});$(".js-menu-item").click(function(){sessionStorage.Page=$(this).data("target");SwitchPage()});$(".js-navbar-toggler").click(function(){$(".js-side-nav").toggleClass("visible")});$(".js-side-nav").click(function(){$(event.target).hasClass("visible")===!0&&$(".js-side-nav").toggleClass("visible")});