var debug="";$(function(){var o={randomize:function(n,t){return Math.floor(Math.random()*(t-n)+n)},shuffle:function(n){for(var i,r,t=n.length;t;i=parseInt(Math.random()*t),r=n[--t],n[t]=n[i],n[i]=r);return n},local:{set:function(n,t){Modernizr.localstorage&&(localStorage[n]=t)},get:function(n){return Modernizr.localstorage?localStorage[n]:null}}},b=["spades","hearts","diams","clubs"],k=["A","2","3","4","5","6","7","8","9","10","J","Q","K"],d=[11,2,3,4,5,6,7,8,9,10,10,10,10],c=[],h=[],r=1e3,g=$(".player-hand"),nt=$(".casino"),l=$(".hit-btn, .stand-btn"),v=$(".deal-btn .btn, .bet-val"),y=$(".bank span"),n={player:0,casino:0},f="idle",t=0,u=500;y.html(u);var a=function(u){var k,v,d,p,tt,it,b;if(u===!0&&(n.casino==n.player?(i("Stay. "+n.casino),e.give(+t)):n.casino<n.player?(i("You win $"+t*2),e.give(t*2)):i(n.casino+". Casino wins"),s()),h.length){k=h.shift();v=c.shift();debug+=JSON.stringify(v)+",";var y="",rt='<span class="mark">\t\t\t\t\t\t\t<h1>'+v.value+"<\/h1>\t\t\t\t\t\t\t<h2>&"+v.suit+";<\/h2>\t\t\t\t\t\t<\/span>",ut='<span class="suit">&'+v.suit+";<\/span>";if(v.order<10)for(d=0;d<v.order;d++)ut+='<span class="suit">&'+v.suit+";<\/span>";y+='<div class="card '+(k.player?"player":"casino")+"-card val"+v.value+" "+v.suit+' anim"><div class="face">';y+=rt+ut+rt;y+='<\/div><div class="back"><\/div><\/div>';y=$(y);y.css({top:$(".deck").offset().top,left:$(".deck").offset().left});p=nt;k.player?(p=g,n.player+=v.score):n.casino+=v.score;tt=p.find(".card").length;it=p.width()*.5;$(".poker-container").append(y);y.animate({top:p.offset().top},r,function(){var t,n,i,r;for($(this).remove(),p.append(y),y.removeClass("anim").attr("style",Modernizr._prefixes.join("transform:rotate("+o.randomize(-4,3)+"deg);")).css({left:it-55}),t=it-(tt+1)*55,n=0;n<=tt;n++)i=p.find(".card").eq(n),r=t+o.randomize(105,115)*n,i.animate({left:r})});k.flip&&y.addClass("flip");h.length&&setTimeout(a,r);k.player?(n.player>21?(b=$(".valA.player-card"),b.length>0&&$(".player-card.valAone").length===0?(n.player-=10,b.toggleClass("valA valAone"),n.player===21?(i("Black Jack! You win "+t*3+"$"),e.give(t*3),s()):i("Your's score is "+n.player)):(i("You're busted"),l.disable(),s())):n.player===21?(i("Black Jack! You win "+t*3+"$"),l.disable(),e.give(t*3),s()):i("Your's score is "+n.player),p.find(".card").length>0&&f!=="end"&&setTimeout(function(){l.enable()},1e3)):f=="casinoTurn"&&(n.casino>21?(b=$(".valA.casino-card"),b.length>0&&$(".casino-card.valAone").length===0?(n.casino-=10,b.toggleClass("valA valAone"),n.casino===21?(i("Black Jack. Casino wins"),s()):f==="casinoTurn"&&setTimeout(w,r)):(e.give(t*2),s(),i("Casino's busted. You win "+t+"$"),e.give(t*2))):n.casino===21?(i("Black Jack. Casino wins"),s()):f==="casinoTurn"&&setTimeout(w,r))}},s=function(){f="end";setTimeout(tt,3e3)},p=function(){var s,r;for(c=[],s=0;s<4;s++)for(r=0;r<13;r++)c.push({value:k[r],suit:b[s],order:r,score:d[r]});h=[{player:!0,flip:!0},{player:!1,flip:!0},{player:!0,flip:!0},{player:!1,flip:!1}];n={player:0,casino:0};c=o.shuffle(c);i("New game");debug+="<<NEW GAME>>";t=$(".bet-val").val();(t<5||t>50)&&(t=10,$(".bet-val").val(10));t>u&&(t=u,$(".bet-val").val(t));o.local.set("21stake",t);f="game";e.take(t);a()},tt=function(){f="idle";var n=$(".player-hand").width()*.5;$(".player-hand .card, .casino .card").animate({left:n-55,opacity:0},r,function(){$(this).remove()});u===0&&($(".autodeal").prop("checked",!1),i("There is another $5 to start the new game","casino",5e3),e.give(5),$(".bet-val").val(5));$(".autodeal").prop("checked")?setTimeout(p,r*1.2):v.enable()},w=function(){i(n.casino);n.casino>=17||n.casino>n.player?setTimeout(function(){a(!0)},r):(h.push({player:!1,flip:!0}),setTimeout(a,r))},i=function(n,t,i){var u=t||"casino",f=$('<div class="speakballon '+u+'-speak">'+n+"<\/div>");setTimeout(function(){$("."+u+"-speak").remove();f.appendTo(".poker-container").fadeIn()},r);setTimeout(function(){f.fadeOut(function(){$(this).remove()})},i||2e3)},e={take:function(n){u-=n;y.html(u);o.local.set("21money",u)},give:function(n){u+=n;y.html(u);o.local.set("21money",u)}};$(".hit-btn").on("click",function(){debug+="<<HIT>>";l.disable();h.push({player:!0,flip:!0});i("Hit me","player");a()});$(".stand-btn").on("click",function(){debug+="<<STAND>>";l.disable();f="casinoTurn";$(".casino .card:eq(1)").addClass("flip");i("Stand","player");setTimeout(w,r)});$(".autodeal").on("click",function(){v.disable();var n=$(".deal-btn .btn"),t=n.toggleClass("btn-success").hasClass("btn-success");f==="idle"&&p()});$(".deal-btn .btn").on("click",function(){v.disable();p()});$(document).on("keydown",function(n){switch(n.keyCode){case 68:$(".deal-btn .btn:enabled").click();break;case 72:$(".hit-btn:enabled").click();break;case 83:$(".stand-btn:enabled").click();break;case 38:$(".bet-val").val(Math.min(+$(".bet-val").val()+5,50));break;case 40:$(".bet-val").val(Math.max(+$(".bet-val").val()-5,5));break;case 65:$(".autodeal").click()}});(function(n){n.fn.extend({enable:function(){return this.prop("disabled",!1),this},disable:function(){return this.prop("disabled",!0),this}})})(jQuery);$(".bet-val").val(o.local.get("21stake")||10)});